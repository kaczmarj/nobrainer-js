(function(e){function t(t){for(var a,i,s=t[0],c=t[1],l=t[2],d=0,f=[];d<s.length;d++)i=s[d],r[i]&&f.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={app:0},o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/nobrainer-js/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";var a=n("c21b"),r=n.n(a);r.a},1:function(e,t){},2:function(e,t){},2231:function(e,t,n){"use strict";var a=n("ec64"),r=n.n(a);r.a},3:function(e,t){},4:function(e,t){},"4ac8":function(e,t,n){},"5b7c":function(e,t,n){"use strict";var a=n("4ac8"),r=n.n(a);r.a},"84df":function(e,t,n){},c21b:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);var a=n("2b0e"),r=n("9f7b"),o=(n("f9e3"),n("2dd8"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("b-container",[n("b-row",{staticClass:"mb-5",attrs:{"align-h":"center"}},[n("Header")],1),n("b-row",{staticClass:"mb-5",attrs:{"align-h":"center"}},[n("UploadImage")],1),n("b-row",{attrs:{"align-h":"center"}},[n("PredictImage")],1)],1)],1)}),i=[],s=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},c=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",[e._v("Nobrainer JS")]),n("p",{staticClass:"text-center"},[e._v("Predict on biomedical images using pre-trained TensorFlow models, all in your browser.")]),n("p",{staticClass:"text-center alert-warning"},[e._v("This is experimental and a work in progress.")])])}],l=a["a"].extend({name:"Header",props:{},data(){return{}},computed:{},methods:{}}),u=l,d=(n("2231"),n("2877")),f=Object(d["a"])(u,s,c,!1,null,"585e272f",null);f.options.__file="Header.vue";var p=f.exports,m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h3",[e._v("Upload an image")]),e.$store.state.features.dataURL?n("div",[n("img",{attrs:{id:"features",src:e.$store.state.features.dataURL}})]):n("div",[n("div",{ref:"dropZone",class:["drop-zone",e.dragging?"drop-zone-over":""],on:{dragenter:function(t){e.dragging=!0},dragleave:function(t){e.dragging=!1}}},[e._m(0),n("input",{attrs:{type:"file",accept:"image/*"},on:{change:function(t){e.$store.commit("setImageInfo",t)}}})])])])},g=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"drop-zone-text"},[n("span",[e._v("Drop image here or click to select")])])}],v=a["a"].extend({name:"UploadImage",props:{},data(){return{dataURL:this.$store.state.features.dataURL,dragging:!1}},computed:{},methods:{handleDragOver(e){return{}}}}),h=v,b=(n("da80"),Object(d["a"])(h,m,g,!1,null,"2d40c104",null));b.options.__file="UploadImage.vue";var _=b.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.features.dataURL.length>0?n("div",[n("div",[n("h3",[e._v("Evaluate")]),n("form",{staticClass:"modelForm",on:{submit:function(t){return t.preventDefault(),e.predictImage(t)}}},[n("label",[n("b-select",{attrs:{options:e.models},model:{value:e.modelURL,callback:function(t){e.modelURL=t},expression:"modelURL"}})],1),e.predicted?e._e():n("b-button",{attrs:{type:"submit"}},[e._v("Run")])],1)]),n("canvas",{ref:"predictionsCanvas",attrs:{id:"predictions"}})]):e._e()},w=[],U=n("0b53");function R(e){return U["l"](()=>{const t=e.min();return e.sub(t).div(e.max().sub(t))})}function L(e){return U["l"](()=>{const t=U["g"](e),n=U["j"](U["g"](U["k"](U["a"](e,U["h"](t)))));return U["b"](U["a"](e,U["h"](t)),n)})}function I(e,t,n,a,r){const o=U["f"](e);return o.then(e=>{let o=U["d"](t,n);o=o.toFloat();const i=o.shape[0],s=o.shape[1];let c=U["c"](o,0);const l=[256,256];c=U["e"].resizeNearestNeighbor(c,l),null!==a&&("minmax"===a?c=R(c):"zscore"===a&&(c=L(c)));const u=e.predict(c),d=U["i"](.5,"float32");let f=u.greater(d).squeeze([-1]);return f=f.toFloat(),f=U["e"].resizeNearestNeighbor(f,[i,s]),U["m"](f,r=r)}).catch(e=>{console.log("Failed to load model. Error is printed below."),console.log(e)})}var y=a["a"].extend({name:"PredictImage",props:{},data(){return{modelURL:"",predicted:!1,models:[{value:"",text:"please select an operation"},{value:"models/brain-extraction/2d/unet-minmax/model.json",text:"brain extraction"},{value:"models/meningioma-extraction/2d/unet-minmax/model.json",text:"meningioma extraction"}]}},methods:{predictImage(){I(this.modelURL,this.$store.getters.dataURLAsImageData,1,"minmax",this.$refs.predictionsCanvas),this.predicted=!0},downloadPredictionsCanvas(){const e=this.$refs.predictionsCanvas,t=e.toDataURL("image/png"),n=this.$refs.predictionsDownloadLink;n.href=t}}}),j=y,$=(n("5b7c"),Object(d["a"])(j,x,w,!1,null,"ec536b6c",null));$.options.__file="PredictImage.vue";var O=$.exports,P=n("2f62");a["a"].use(P["a"]);const C={state:{dataURL:""},mutations:{setImageInfo(e,t){if(null!==t.target){const n=t.target,a=n.files;if(null!==a&&a[0]){const t=a[0],n=new FileReader;n.onload=(t=>{null!==t.target?e.dataURL=n.result:console.log("file reader got unexpected null value")}),n.readAsDataURL(t)}}}},getters:{dataURLAsImageData(e){if(""!==e.dataURL){const t=new Image;t.src=e.dataURL;const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const a=n.getContext("2d");return a.drawImage(t,0,0),a.getImageData(0,0,t.width,t.height)}}}},D={state:{URL:String,predictedDataURL:""},mutations:{}},E=new P["a"].Store({modules:{features:C,model:D}});var k=a["a"].extend({name:"app",store:E,components:{Header:p,UploadImage:_,PredictImage:O}}),S=k,z=(n("034f"),Object(d["a"])(S,o,i,!1,null,null,null));z.options.__file="App.vue";var F=z.exports;a["a"].use(r["a"]),a["a"].config.productionTip=!1,new a["a"]({render:e=>e(F)}).$mount("#app")},da80:function(e,t,n){"use strict";var a=n("84df"),r=n.n(a);r.a},ec64:function(e,t,n){}});
//# sourceMappingURL=app.a9022a7f.js.map